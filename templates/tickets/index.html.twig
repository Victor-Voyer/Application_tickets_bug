{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('styles/tickets.css') }}">
{% endblock %}

{% block title %}Tickets index{% endblock %}

{% block body %}
    <section class="tickets-section">
    <form class="tickets-filter-form tickets-filter-form" action="{{ path('app_tickets_index') }}" method="GET">
            <select name="f_type" id="f_type">
                <option value="">Type (all)</option>
                {% set current = app.request.query.get('type') %}
                {% for t in types %}
                    <option value="{{ t.value }}" {{ current == t.value ? 'selected' }}>
                        {{ t.value }}
                    </option>
                {% endfor %}
            </select>
        </form>
        <form class="tickets-filter-form tickets-filter-form" action="{{ path('app_tickets_index') }}" method="GET">
            <select name="f_stack" id="f_stack">
                <option value="">Technology (all)</option>
                {% set current = app.request.query.get('stack') %}
                {% for s in stacks %}
                    <option value="{{ s.value }}" {{ current == s.value ? 'selected' }}>
                        {{ s.value }}
                    </option>
                {% endfor %}
            </select>
        </form>
        <form class="tickets-filter-form tickets-filter-form" action="{{ path('app_tickets_index') }}" method="GET">
            <select name="f_status" id="f_status">
                <option value="">Status (all)</option>
                {% set current = app.request.query.get('status') %}
                {% for s in status %}
                    <option value="{{ s.value }}" {{ current == s.value ? 'selected' }}>
                        {{ s.value }}
                    </option>
                {% endfor %}
            </select>
        </form>
        <form class="tickets-search-form" action="{{ path('app_tickets_index') }}" method="GET">
            <input  type="text" name="q" placeholder="Search tickets">
            <button class="btn btn-primary" type="submit">Search</button>
        </form>
        
    </section>

    <section class="tickets-list">
        <h1>Liste des Tickets</h1>
        
        {% if tickets|length > 0 %}
            <div class="tickets-container">
                {% for ticket in tickets %}
                    <div class="ticket-card">
                        <div class="ticket-card-header">
                            <h2>
                                <a href="{{ path('app_tickets_show', {'id': ticket.id}) }}">
                                    {{ ticket.title }}
                                </a>
                            </h2>
                            <span class="ticket-id">#{{ ticket.id }}</span>
                        </div>
                        
                        <div class="ticket-card-meta">
                            <span class="badge badge-status">{{ ticket.status.status.value }}</span>
                            <span class="badge badge-type">{{ ticket.type.value }}</span>
                            <span class="badge badge-stack">{{ ticket.stack.value }}</span>
                        </div>
                        
                        <div class="ticket-card-content">
                            <h3>Description :</h3>
                            <p>{{ ticket.content|length > 200 ? ticket.content|slice(0, 200) ~ '...' : ticket.content }}</p>
                        </div>
                        
                        <div class="ticket-card-footer">
                            <div class="ticket-author">
                                <strong>Créé par :</strong> 
                                {{ ticket.userId.firstName }} {{ ticket.userId.lastName }}
                            </div>
                            <div class="ticket-date">
                                <strong>Le :</strong> 
                                {{ ticket.createdAt|date('d/m/Y à H:i') }}
                            </div>
                        </div>
                        
                        <div class="ticket-card-actions">
                            <a href="{{ path('app_tickets_show', {'id': ticket.id}) }}" class="btn-tickets btn-primary">Voir détails</a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="no-tickets">Aucun ticket n'a été créé pour le moment.</p>
        {% endif %}
    </section>


{% endblock %}
